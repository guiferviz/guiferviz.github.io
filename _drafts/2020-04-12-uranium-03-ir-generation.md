---
layout: post

title: Uranium 03 - Generating a 'void main' function
excerpt: >
    After generating en empty module the next step is to generate some
    working code. Let's write a main function that return void.
    We will learn something about LLVM contexts, LLVM types and LLVM builders.
date: 2020-04-12
tags: [Compilers, Uranium, LLVM, IR Code]

mathjax: false
comments: true
---

TODO: REWRITE THIS BECAUSE IT COMES FROM SOF
Most things in LLVM are created through a static method call instead of directly using a constructor. One reason is that an existing object can be returned instead of creating a new instance.


"Create a FunctionType taking no parameters."
A better translation would be:
"Create a FunctionType taking no fixed/positional parameters."

After creating the function you get:
```
; ModuleID = 'uranium_module'
source_filename = "main.ura"

declare void @main()
```

After adding the basic block:
```cmd
; ModuleID = 'uranium_module'
source_filename = "main.ura"

define void @main() {
main_block:
}
```

After adding the builder, the block and the return statement:
```cmd
; ModuleID = 'uranium_module'
source_filename = "main.ura"

define void @main() {
main_block:
  ret void
}
```

And finally, after installing, compiling, reading docs and tutorials...
I can compile the generated code!!
I use `2>` to redirect the stderr to a file.
I redirect stderr because the output generated by our program in done by
`mainModule.dump();` and it writes to stderr.


```cmd
make
./uc 2> main.ll
lli main.ll
```

And the output of the last command is... nothing! ðŸŽ‰
Why is that a reason to celebrate?
That's good because without the main function or without the return void
statement the output was an execution error.


# What's next?

I cannot check the correct behaviour of the generated code becase I'm not
doing anything in our code.
Returning and integer to check that the program is working properly will be
the next step.
See you in the next post!


# References

[sofQuestion]: https://stackoverflow.com/questions/61175090/why-llvmfunctiontypetype-bool-has-bool-if-by-definition-it-doesnt-take-pa
[llvmLinkages]: https://llvm.org/docs/LangRef.html#linkage-types

